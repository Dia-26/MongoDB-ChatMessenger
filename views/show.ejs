<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Message Details</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <a href="/" class="back-link">
                        <i class="fas fa-arrow-left"></i>
                    </a>
                    <h1>Message Details</h1>
                </div>
                <div class="header-actions">
                    <a href="/chats/<%= chat._id %>/edit" class="btn-edit">
                        <i class="fas fa-edit"></i> Edit
                    </a>
                </div>
            </div>
        </header>

        <div class="message-details">
            <!-- Main Message Card -->
            <div class="detail-card">
                <div class="detail-header">
                    <div class="direction">
                        <div class="user from">
                            <i class="fas fa-user-circle"></i>
                            <div>
                                <span class="label">From</span>
                                <h3><%= chat.from %></h3>
                            </div>
                        </div>
                        <i class="fas fa-arrow-right arrow-icon"></i>
                        <div class="user to">
                            <i class="fas fa-user-friends"></i>
                            <div>
                                <span class="label">To</span>
                                <h3><%= chat.to %></h3>
                            </div>
                        </div>
                    </div>
                    
                    <div class="message-actions">
                        <div class="action-btn" onclick="copyToClipboard('<%= chat.msg %>')" title="Copy Message">
                            <i class="fas fa-copy"></i>
                        </div>
                        <div class="action-btn" onclick="shareMessage()" title="Share">
                            <i class="fas fa-share"></i>
                        </div>
                    </div>
                </div>

                <div class="detail-body">
                    <div class="message-content">
                        <div class="quote-open">
                            <i class="fas fa-quote-left"></i>
                        </div>
                        <p><%= chat.msg %></p>
                        <div class="quote-close">
                            <i class="fas fa-quote-right"></i>
                        </div>
                    </div>
                </div>

                <div class="detail-footer">
                    <div class="metadata">
                        <div class="meta-item">
                            <i class="fas fa-fingerprint"></i>
                            <div>
                                <span class="meta-label">Message ID</span>
                                <span class="meta-value"><%= chat._id %></span>
                            </div>
                        </div>
                        
                        <div class="meta-item">
                            <i class="far fa-calendar-plus"></i>
                            <div>
                                <span class="meta-label">Created</span>
                                <span class="meta-value"><%= chat.created_at.toLocaleString() %></span>
                            </div>
                        </div>

                        <% if (chat.updated_at) { %>
                        <div class="meta-item">
                            <i class="far fa-calendar-check"></i>
                            <div>
                                <span class="meta-label">Last Updated</span>
                                <span class="meta-value"><%= chat.updated_at.toLocaleString() %></span>
                            </div>
                        </div>
                        <% } %>

                        <div class="meta-item">
                            <i class="fas fa-ruler-horizontal"></i>
                            <div>
                                <span class="meta-label">Length</span>
                                <span class="meta-value"><%= chat.msg.length %> characters</span>
                            </div>
                        </div>
                    </div>

                    <div class="status-info">
                        <div class="status-item delivered">
                            <i class="fas fa-check-double"></i>
                            <span>Delivered</span>
                        </div>
                        <div class="status-item read">
                            <i class="fas fa-eye"></i>
                            <span>Read</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <a href="/" class="btn-action">
                    <i class="fas fa-inbox"></i> Back to All Messages
                </a>
                <a href="/chats/<%= chat._id %>/edit" class="btn-action primary">
                    <i class="fas fa-edit"></i> Edit Message
                </a>
                <button class="btn-action danger" id="deleteBtn">
                    <i class="fas fa-trash"></i> Delete Message
                </button>
            </div>
        </div>

        <!-- Delete Modal -->
        <div id="deleteModal" class="modal">
            <div class="modal-content">
                <h3><i class="fas fa-exclamation-triangle"></i> Delete Message</h3>
                <p>Are you sure you want to delete this message? This action cannot be undone.</p>
                <div class="modal-actions">
                    <button id="cancelDelete" class="btn-secondary">Cancel</button>
                    <form action="/chats/<%= chat._id %>?_method=DELETE" method="POST" style="display: inline;">
                        <button type="submit" class="btn-danger">
                            <i class="fas fa-trash"></i> Delete Permanently
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Delete modal
            const deleteBtn = document.getElementById('deleteBtn');
            const deleteModal = document.getElementById('deleteModal');
            const cancelDelete = document.getElementById('cancelDelete');

            deleteBtn.addEventListener('click', function() {
                deleteModal.style.display = 'flex';
            });

            cancelDelete.addEventListener('click', function() {
                deleteModal.style.display = 'none';
            });

            window.addEventListener('click', function(event) {
                if (event.target === deleteModal) {
                    deleteModal.style.display = 'none';
                }
            });
        });

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text)
                .then(() => {
                    alert('Message copied to clipboard!');
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                });
        }

        function shareMessage() {
            const text = `"${chat.msg}" - ${chat.from} to ${chat.to}`;
            if (navigator.share) {
                navigator.share({
                    title: 'WhatsApp Message',
                    text: text,
                    url: window.location.href
                });
            } else {
                copyToClipboard(text);
                alert('Message copied to clipboard! You can now share it.');
            }
        }
    </script>
</body>
</html>